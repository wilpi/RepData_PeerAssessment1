# Reproducible Research: Peer Assessment 1


## Loading and preprocesing data

### Loading

```{r}
packages <- c("data.table", "ggplot2", "xtable", "VIM")
sapply(packages, require, character.only=TRUE, quietly=TRUE)
fileUrl <- "https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2Factivity.zip"
download.file(fileUrl, destfile = "Dataset.zip", method = "curl")
unzip("Dataset.zip")
activity <- read.csv("./activity.csv")
```

### Process  the data

```{r}
activity$date <- as.Date(activity$date)
length(activity$steps)
summary(activity)

```


## What is mean total number of steps taken per day?

> For this part ignore the missing values in
> the dataset.
>
> 1. Make a histogram of the total number of steps taken each day
>
> 2. Calculate and report the **mean** and **median** total number of steps taken per day

Aggregate the number of steps taken each day.
Days with missing values (`NA`) will have `NA` when aggregated.

```{r}
m<-tapply(activity$steps, activity$date,sum)
edit(head(m))

```

Plot a histogram of the total number of steps taken each day. (for understand variability between days)

```{r }
hist(m)
```

Calculate the mean and median total number of steps taken per day **before imputing**.

```{r, results='asis'}
summary(m)
```



## What is the average daily activity pattern?

> 1. Make a time series plot (i.e. `type = "l"`) of the 5-minute interval (x-axis) and the average number of steps taken, averaged across all days (y-axis)
>
> 2. Which 5-minute interval, on average across all the days in the dataset, contains the maximum number of steps?

Aggregate the average number of steps taken by 5-minute interval.

```{r}
average_steps<-data.frame(cbind(activity$interval,tapply(activity$steps, activity$interval, mean, na.rm = TRUE)))
colnames(average_steps) <- c("interval","steps")

```

Plot a time series of the 5-minute interval and the average number of steps taken across all days.

```{r timeseriesStepsTakenEachInterval}
q<-ggplot(data=average_steps,aes(x=interval,y=steps)) +
  geom_line()
print(q)
```


## Imputing missing values

Calculate the total number of missing values.

```{r, results='asis'}
dt <- dt[, isStepsMissing := is.na(steps)]
tab <- dt[, .N, isStepsMissing]
print(xtable(tab), type="html", include.rownames=FALSE)
```

Use k-Nearest Neighbour Imputation.
I couldn't get Iterative robust model-based imputation (IRMI) to work; try again later.

```{r}
dt <- kNN(dt)
# dt <- irmi(dt)
```

Verify that there are no missing values for `steps` after imputation.

```{r, results='asis'}
tab <- dt[, .N, list(isMissing = is.na(steps))]
print(xtable(tab), type="html", include.rownames=FALSE)
```

```{r}
dtMissingness <- dt[, list(countMissing = sum(isStepsMissing), countRecords = .N, propMissing = sum(isStepsMissing / .N)), date]
dtMissingness[countMissing > 0]
```



## Are there differences in activity patterns between weekdays and weekends?

```{r}
levels <- c("Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday")
newLevels <- c("Weekend", rep("Weekday", 5), "Weekend")
dt <- dt[, dayOfWeek := factor(weekdays(date), levels=levels)]
dt <- dt[, dayType := factor(newLevels[dayOfWeek])]
dt[, .N, list(dayType, dayOfWeek)]
message(sprintf("Is dayOfWeek a factor? %s. Is dayType a factor? %s", is.factor(dt$dayOfWeek), is.factor(dt$dayType)))
```

Aggregate the average number of steps taken by 5-minute interval.
Use the imputed values in the `steps` variable.

```{r}
dtIntervals <- dt[, list(meanSteps = mean(steps, na.rm=TRUE)), list(dayType, interval)]
```

Plot two time series (one for weekdays and the other for weekends) of the 5-minute intervals and average number of steps taken (imputed values).

```{r timeseriesStepsTakenEachIntervalByDayTypePanel}
ggplot(dtIntervals, aes(x=interval, y=meanSteps, color=dayType)) +
geom_line() +
facet_wrap(~ dayType, nrow=2) +
theme(legend.position="none")
```

It's a bit hard to discern any differences.
So overlay the time series on a single plot instead of using a panel plot.

```{r timeseriesStepsTakenEachIntervalByDayType}
ggplot(dtIntervals, aes(x=interval, y=meanSteps, color=dayType)) +
geom_line() +
theme(legend.position="bottom")
```


